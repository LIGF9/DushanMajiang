# 独山麻将

一个基于Pygame开发的独山麻将游戏，支持人机对战和AI自动对战。

## 游戏特色

- 🎮 **完整的麻将游戏体验**：支持碰、杠、胡等基本操作
- 🤖 **智能AI对手**：多种AI策略，可选择不同难度
- 🎵 **丰富的音效和背景音乐**：沉浸式游戏体验
- 🎨 **精美的游戏界面**：多种角色选择
- 📊 **游戏历史记录**：保存每局游戏结果，支持查看历史对战记录
- ⚙️ **灵活的游戏设置**：可调整游戏参数、AI思考时间等

## 功能地图

### 已实现功能
- ~~摸牌、出牌、碰杠检测和执行、判听、判胡、杠上开花、抢杠胡、黄牌包鸡、翻鸡（上下鸡）等基本游戏流程全部实现~~

### 待实现功能
1. 首轮四人跟打的牌，庄家需要支付其他三名玩家3分，这四张牌算作庄家的杠（不算分，算通行证）
2. 黄牌时，未叫牌玩家包牌（其他玩家的非平胡牌型：清一色/碰碰胡/单调将/七对子/龙七对）

## 安装说明

### 环境要求

- Python 3.8+  
- Pygame 2.6+

### 安装依赖

1. 克隆或下载项目到本地
2. 打开命令行终端，进入项目根目录
3. 使用uv创建并激活虚拟环境：

```bash
# 创建虚拟环境
uv venv pygame_env

# 激活虚拟环境（Windows）
pygame_env\Scripts\activate

# 激活虚拟环境（Linux/macOS）
source pygame_env/bin/activate
```

4. 在虚拟环境中安装所需依赖：

```bash
# 使用pip安装
pip install -r requirements.txt

# 推荐使用uv pip安装，速度更快
uv pip install -r requirements.txt
```

## 运行游戏

### 方式一：直接运行可执行文件
(需要自行编译，参考[打包说明](#打包说明))
在 `dist` 目录下找到 `majiang.exe`，双击即可运行。

### 方式二：从源码运行

```bash
python majiang.py
```

## 游戏规则

### 基本规则

- **牌型**：使用标准麻将牌，包括万、条、筒各1-9，共108张牌，不可以吃牌，1条为鸡牌
- **人数**：4人游戏，3个AI+1玩家，或者人类思考时间完成时自动按照AI推荐执行操作
- **庄家**：第一局随机选择庄家，之后由上一局赢家坐庄，黄庄不换庄
- **手牌**：每人初始13张牌，通过摸牌、打牌、碰杠牌等操作进行游戏
- **胡牌**：组成符合规则的牌型即可胡牌(与其他麻将变种胡牌牌型无异)
- **特殊规则**：
  - 吃胡需要通行证(报叫，杠牌，清一色/碰碰胡/单调将/七对子/龙七对)
  - 报叫：玩家打出第一张牌后即叫牌，声明“报叫”之后该玩家不可碰杠不可改叫。其他玩家也可吃胡报叫玩家打出的牌。
  - 玩家杠牌后打出的第一张牌为热炮牌，视为所有玩家拥有临时通行证可以吃胡热炮牌。
  - 每名打出玩家的首张牌若为鸡牌则称为[冲锋鸡]+3分；全场打出的第一张鸡牌为[横鸡]+2分（冲锋鸡的情况除外，横鸡可以同轮跟打）；横鸡那一轮之后的鸡牌称为[幺鸡]+1分。
  - 责任鸡：被碰/杠的鸡牌称为出牌玩家的责任鸡，分数归于碰/杠的玩家。仅对打出鸡牌的玩家计算责任鸡分数，其他玩家仅需按照幺鸡面值计算。
  - 支持【海底捞月】【妙手回春】【杠上开花】【杠上加杠】【一炮多响】【抢杠胡】【捉热炮】【幺鸡】【横鸡】【冲锋鸡】

## 项目结构

```
DuShanMajiang/
├── data/                 # 游戏数据和历史记录
│   └── history/          # 历史对战记录
├── dist/                 # 打包后的可执行文件
│   └── data/             # 打包运行时数据
├── resource/             # 游戏资源文件
│   ├── avatar/           # 角色头像
│   ├── font/             # 字体文件
│   ├── sound/            # 音效和背景音乐
│   ├── sprites/          # 游戏精灵图
│   ├── table/            # 游戏桌子资源
│   └── tiles/            # 麻将牌资源
├── source/               # 源代码目录
│   ├── __pycache__/      # 编译后的Python文件
│   ├── game_manager.py   # 游戏逻辑管理
│   ├── player.py         # 玩家类
│   ├── public.py         # 公共常量和工具
│   ├── rule.py           # 游戏规则
│   ├── sound_manager.py  # 音效管理
│   ├── tile.py           # 麻将牌类
│   └── ui_manager.py     # UI界面管理
├── majiang.py            # 游戏入口
├── majiangAI.py          # AI算法实现
├── majiang.spec          # PyInstaller打包配置
├── requirements.txt      # 依赖列表
└── settings.py           # 游戏设置
```

## 游戏操作

### 主菜单

- **开始游戏**：进入游戏界面
- **设置**：调整游戏参数
- **历史对局**：查看过往游戏记录

### 游戏中

- **鼠标左键**：
  - 点击手牌：选择要打出的牌
  - 点击操作按钮：执行碰、杠、胡等操作
  - 点击设置按钮：打开游戏设置
  - 支持暂停游戏，点击暂停按钮后可继续游戏

## 开发说明

### 核心模块

1. **GameManager**：负责游戏逻辑的核心管理，包括游戏流程控制、玩家管理等
2. **UIManager**：负责游戏界面的渲染和用户交互
3. **Player**：玩家类，包含玩家的手牌、操作等信息
4. **Tile**：麻将牌类，定义了牌的属性和行为
5. **SoundManager**：音效管理，负责播放背景音乐和游戏音效
6. **majiangAI**：AI算法实现，提供不同难度的AI对手

### 扩展开发

1. **添加新AI策略**：在 `majiangAI.py` 中添加新的AI类
2. **修改游戏规则**：编辑 `rule.py` 文件
3. **添加新角色**：在 `resource/avatar/` 目录下添加新头像
4. **修改界面样式**：编辑 `ui_manager.py` 和相关资源文件

### 打包说明

使用PyInstaller打包游戏：

```bash
pyinstaller majiang.py
```

## 游戏设置详解

### 支持的设置项

- **人类思考时间**：玩家考虑出牌的最长时间（秒）
- **AI思考时间**：AI考虑出牌的最长时间（秒）
- **初始分数**：游戏开始时每个玩家的初始分数
- **测试轮数**：测试模式下自动进行的游戏局数
- **游戏难度**：调整AI对手的智能程度/高智能对手数量和分布，分为简单、中等、困难三种
- **加速模式**：加快游戏进程，适合测试和快速游戏
- **显示所有牌面**：是否显示其他玩家的手牌
- **显示玩家名称**：是否在游戏中显示玩家名称
- **显示AI版本号**：是否显示AI玩家的版本信息
- **播放背景音乐**：是否开启背景音乐
- **背景音乐音量**：调整背景音乐音量
- **播放游戏音效**：是否开启游戏音效
- **游戏音效音量**：调整游戏音效音量
- **播放打牌读牌音效**：是否播放出牌时的语音提示
- **打牌读牌音效音量**：调整语音提示音量
- **默认再来一局计时**：游戏结束后自动开始下一局的等待时间

## 历史记录

游戏会自动保存每局游戏的结果，包括：

- 玩家信息和分数变化
- 每轮出牌记录
- 胡牌牌型和番数
- 游戏时长

可以在主菜单的"历史对局"中查看详细记录。

## 技术栈

- **开发语言**：Python 3.8+
- **游戏引擎**：Pygame 2.0+
- **UI设计**：Pygame原生绘图
- **AI算法**：基于规则的决策树算法
- **打包工具**：PyInstaller

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 联系方式

- **开发者**：LIGF
- **版本**：1.0.0
- **更新日期**：2025-11-17

## 更新日志

### v1.0.0 (2025-11-17)

- 初始版本发布
- 支持基本麻将游戏功能
- 实现AI对手
- 加入音效和背景音乐
- 支持游戏历史记录

### v1.1.0 (2025-12-25)

- 优化AI算法
- 增加游戏角色选择
- 优化游戏界面
- 修复已知bug

## 常见问题

### Q: 如何调整游戏音量？
A: 在游戏设置中可以调整背景音乐和音效音量。

### Q: 如何修改游戏规则？
A: 可以编辑 `rule.py` 文件中的规则实现。

## 贡献

欢迎提交Issue和Pull Request，共同改进游戏！

## 致谢

- 感谢所有为项目提供帮助和支持的朋友
- 感谢Pygame社区提供的优秀游戏引擎
- 感谢所有测试和反馈的玩家

---

祝您游戏愉快！🎉